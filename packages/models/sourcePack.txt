# ðŸ“ PROJECT DIRECTORY STRUCTURE

Total: 45 files, 2 directories

```
headlines/
â”œâ”€â”€ ðŸ“ src/
â”‚   â”œâ”€â”€ ðŸ“ schemas/
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ apiSchemas.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ articleAssessmentSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ articlePreAssessmentSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ batchArticleAssessmentSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ batchHeadlineAssessmentSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ canonicalizerSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ clusterSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ countryCorrectionSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ disambiguationSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ emailIntroSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ emailSubjectSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ enrichContactSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ entitySchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ executiveSummarySchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ findContactSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ headlineAssessmentSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ index.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ judgeSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ opportunitySchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ ragResponseSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ sectionClassifierSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ selectorRepairSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ synthesisSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ translateSchema.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ userSchemas.js
â”‚   â”‚   â”œâ”€â”€ ðŸ“„ watchlistSchemas.js
â”‚   â”‚   â””â”€â”€ ðŸ“„ watchlistSuggestionSchema.js
â”‚   â”œâ”€â”€ ðŸ“„ Article.js
â”‚   â”œâ”€â”€ ðŸ“„ client.js
â”‚   â”œâ”€â”€ ðŸ“„ Country.js
â”‚   â”œâ”€â”€ ðŸ“„ index.js
â”‚   â”œâ”€â”€ ðŸ“„ next.js
â”‚   â”œâ”€â”€ ðŸ“„ node.js
â”‚   â”œâ”€â”€ ðŸ“„ Opportunity.js
â”‚   â”œâ”€â”€ ðŸ“„ prompt-constants.js
â”‚   â”œâ”€â”€ ðŸ“„ PushSubscription.js
â”‚   â”œâ”€â”€ ðŸ“„ RunVerdict.js
â”‚   â”œâ”€â”€ ðŸ“„ Setting.js
â”‚   â”œâ”€â”€ ðŸ“„ Source.js
â”‚   â”œâ”€â”€ ðŸ“„ SourceSuggestion.js
â”‚   â”œâ”€â”€ ðŸ“„ Subscriber.js
â”‚   â”œâ”€â”€ ðŸ“„ SynthesizedEvent.js
â”‚   â”œâ”€â”€ ðŸ“„ WatchlistEntity.js
â”‚   â””â”€â”€ ðŸ“„ WatchlistSuggestion.js
â””â”€â”€ ðŸ“„ package.json
```

# ðŸ“‹ PROJECT METADATA

**Generated**: 2025-10-05T19:41:33.281Z
**Repository Path**: /home/mark/Repos/projects/headlines/packages/models
**Total Files**: 45
**Package**: @headlines/models@2.0.0
**Description**: Shared Mongoose models and Zod validation schemas for the Headlines monorepo.



---


## ðŸ“„ package.json
*Lines: 21, Size: 502 Bytes*

```json
{
  "name": "@headlines/models",
  "version": "2.0.0",
  "description": "Shared Mongoose models and Zod validation schemas for the Headlines monorepo.",
  "main": "src/node.js",
  "type": "module",
  "license": "ISC",
  "exports": {
    ".": "./src/node.js",
    "./node": "./src/node.js",
    "./next": "./src/next.js",
    "./client": "./src/client.js",
    "./schemas": "./src/schemas/index.js"
  },
  "dependencies": {
    "bcryptjs": "^3.0.2",
    "mongoose": "^8.4.1",
    "zod": "^3.23.8"
  }
}

```

## ðŸ“„ src/Article.js
*Lines: 79, Size: 2.51 KB*

```javascript
// packages/models/src/Article.js (version 2.1.0 - Multi-country support)
import mongoose from 'mongoose'
import { ARTICLE_STATUSES } from './prompt-constants.js'

const { Schema, model, models } = mongoose

const LifecycleEventSchema = new Schema(
  {
    stage: { type: String, required: true },
    status: { type: String, required: true },
    reason: { type: String },
    timestamp: { type: Date, default: Date.now },
  },
  { _id: false }
)

const ArticleSchema = new Schema(
  {
    headline: { type: String, required: true, trim: true, minlength: 5, maxlength: 500 },
    headline_en: { type: String, trim: true },
    link: { type: String, required: true, unique: true, trim: true },
    newspaper: { type: String, required: true, trim: true },
    source: { type: String, required: true, trim: true },
    country: { type: [String], trim: true, index: true }, // MODIFIED: Changed to array of strings
    imageUrl: { type: String, trim: true },
    relevance_headline: { type: Number, required: true, min: 0, max: 100 },
    assessment_headline: { type: String, required: true, trim: true },
    articleContent: {
      type: { contents: { type: [String], default: [] } },
      required: false,
      select: false,
    },
    relevance_article: { type: Number, min: 0, max: 100 },
    assessment_article: { type: String, trim: true },
    key_individuals: [
      {
        _id: false,
        name: String,
        role_in_event: String,
        company: String,
        email_suggestion: String,
      },
    ],
    enrichment_error: { type: String, trim: true },
    emailed: { type: Boolean, default: false },
    embedding: { type: [Number], select: false },
    synthesizedEventId: {
      type: Schema.Types.ObjectId,
      ref: 'SynthesizedEvent',
      index: true,
      required: false,
    },
    status: { type: String, enum: ARTICLE_STATUSES, default: 'scraped', index: true },
    pipeline_lifecycle: { type: [LifecycleEventSchema], default: [] },
  },
  {
    timestamps: true,
    collection: 'articles',
    methods: {
      toRealtimePayload() {
        return {
          _id: this._id,
          headline: this.headline,
          headline_en: this.headline_en,
          link: this.link,
          newspaper: this.newspaper,
          country: this.country,
          relevance_article: this.relevance_article,
          createdAt: this.createdAt,
        }
      },
    },
  }
)

ArticleSchema.index({ headline: 'text', headline_en: 'text', assessment_article: 'text' })

export default models.Article || model('Article', ArticleSchema)

```

## ðŸ“„ src/Country.js
*Lines: 29, Size: 663 Bytes*

```javascript
// packages/models/src/Country.js (version 5.0.0)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const CountrySchema = new Schema(
  {
    name: { type: String, required: true, unique: true, trim: true },
    isoCode: {
      type: String,
      required: true,
      unique: true,
      trim: true,
      uppercase: true,
      minlength: 2,
      maxlength: 2,
    },
    status: {
      type: String,
      enum: ['active', 'inactive'],
      default: 'active',
      required: true,
      index: true,
    },
  },
  { timestamps: true, collection: 'countries' }
)

export default models.Country || model('Country', CountrySchema)

```

## ðŸ“„ src/Opportunity.js
*Lines: 30, Size: 1.12 KB*

```javascript
// packages/models/src/Opportunity.js (version 9.1.0 - Multi-country support)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const ContactDetailsSchema = new Schema(
  {
    email: { type: String, trim: true },
    role: { type: String, trim: true },
    company: { type: String, trim: true },
  },
  { _id: false }
)

const OpportunitySchema = new Schema(
  {
    reachOutTo: { type: String, required: true, trim: true, unique: true, index: true },
    contactDetails: { type: ContactDetailsSchema },
    basedIn: { type: [String], trim: true, index: true }, // MODIFIED: Changed to array of strings
    city: { type: String, trim: true, required: false },
    whyContact: { type: [String], required: true },
    likelyMMDollarWealth: { type: Number, required: true, default: 0 },
    embedding: { type: [Number] },
    events: [{ type: Schema.Types.ObjectId, ref: 'SynthesizedEvent', index: true }],
    relatedOpportunities: [{ type: Schema.Types.ObjectId, ref: 'Opportunity' }],
  },
  { timestamps: true, collection: 'opportunities' }
)

export default models.Opportunity || model('Opportunity', OpportunitySchema)

```

## ðŸ“„ src/PushSubscription.js
*Lines: 24, Size: 644 Bytes*

```javascript
// packages/models/src/PushSubscription.js (version 5.0.0)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const PushSubscriptionSchema = new Schema(
  {
    subscriberId: {
      type: Schema.Types.ObjectId,
      ref: 'Subscriber',
      required: true,
      index: true,
    },
    endpoint: { type: String, required: true, unique: true },
    keys: {
      p256dh: { type: String, required: true },
      auth: { type: String, required: true },
    },
  },
  { timestamps: true, collection: 'push_subscriptions' }
)

export default models.PushSubscription ||
  model('PushSubscription', PushSubscriptionSchema)

```

## ðŸ“„ src/RunVerdict.js
*Lines: 20, Size: 769 Bytes*

```javascript
// packages/models/src/RunVerdict.js (version 5.0.0)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const RunVerdictSchema = new Schema(
  {
    runStats: { type: Schema.Types.Mixed, required: true },
    judgeVerdict: { type: Schema.Types.Mixed, required: false, default: {} },
    generatedEvents: [{ type: Schema.Types.ObjectId, ref: 'SynthesizedEvent' }],
    generatedOpportunities: [{ type: Schema.Types.ObjectId, ref: 'Opportunity' }],
    duration_seconds: { type: Number, required: true },
    cost_summary: { type: Schema.Types.Mixed, required: false },
  },
  { timestamps: true, collection: 'run_verdicts' }
)

RunVerdictSchema.index({ createdAt: -1 })

export default models.RunVerdict || model('RunVerdict', RunVerdictSchema)

```

## ðŸ“„ src/Setting.js
*Lines: 40, Size: 1.14 KB*

```javascript
// packages/models/src/Setting.js (version 5.0.0)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const SETTING_KEYS = [
  'HEADLINES_RELEVANCE_THRESHOLD',
  'ARTICLES_RELEVANCE_THRESHOLD',
  'EVENT_RELEVANCE_THRESHOLD',
  'MINIMUM_EVENT_AMOUNT_USD_MILLIONS',
  'HIGH_SIGNAL_HEADLINE_THRESHOLD',
  'AGENT_DISAGREEMENT_THRESHOLD',
  'SINGLETON_RELEVANCE_THRESHOLD',
  'HIGH_VALUE_DEAL_USD_MM',
  'SIGNIFICANT_PRIVATE_BENEFICIARY_USD_MM',
  'WATCHLIST_SCORE_BOOST',
  'SUGGESTION_GENERATION_THRESHOLD',
  'MIN_ARTICLE_CHARS',
  'LLM_MODEL_HEADLINE_ASSESSMENT',
  'LLM_MODEL_ARTICLE_ASSESSMENT',
  'LLM_MODEL_SYNTHESIS',
  'LLM_MODEL_UTILITY',
]

const SettingSchema = new Schema(
  {
    key: { type: String, required: true, unique: true, index: true, enum: SETTING_KEYS },
    value: { type: Schema.Types.Mixed, required: true },
    description: { type: String, required: false, trim: true },
    type: {
      type: String,
      required: true,
      enum: ['number', 'boolean', 'string'],
      default: 'number',
    },
  },
  { timestamps: true, collection: 'settings' }
)

export default models.Setting || model('Setting', SettingSchema)

```

## ðŸ“„ src/Source.js
*Lines: 66, Size: 2.25 KB*

```javascript
// packages/models/src/Source.js (version 7.2.0 - ledeSelector removed)
import mongoose from 'mongoose'
import {
  SOURCE_STATUSES,
  SOURCE_FREQUENCIES,
  EXTRACTION_METHODS,
} from './prompt-constants.js'
const { Schema, model, models } = mongoose

const SourceAnalyticsSchema = new Schema(
  {
    totalRuns: { type: Number, default: 0 },
    totalSuccesses: { type: Number, default: 0 },
    totalFailures: { type: Number, default: 0 },
    totalScraped: { type: Number, default: 0 },
    totalRelevant: { type: Number, default: 0 },
    lastRunHeadlineCount: { type: Number, default: 0 },
    lastRunRelevantCount: { type: Number, default: 0 },
    lastRunContentSuccess: { type: Boolean, default: false },
  },
  { _id: false }
)

const SourceSchema = new Schema(
  {
    name: { type: String, required: true, unique: true, trim: true },
    baseUrl: { type: String, required: true, trim: true },
    sectionUrl: { type: String, required: true, trim: true },
    country: { type: String, required: true, trim: true, index: true },
    language: { type: String, required: true, trim: true, default: 'en' },
    status: {
      type: String,
      enum: SOURCE_STATUSES,
      default: 'active',
      required: true,
      index: true,
    },
    scrapeFrequency: {
      type: String,
      enum: SOURCE_FREQUENCIES,
      default: 'high',
      required: true,
    },
    extractionMethod: {
      type: String,
      enum: EXTRACTION_METHODS,
      required: true,
      default: 'declarative',
    },
    headlineSelector: { type: [String], required: false, default: [] },
    linkSelector: { type: String, required: false, trim: true },
    headlineTextSelector: { type: String, required: false, trim: true },
    // ledeSelector: { type: [String], required: false, default: [] }, // REMOVED
    articleSelector: { type: [String], required: false, default: [] },
    lastScrapedAt: { type: Date, required: false, index: true },
    lastSuccessAt: { type: Date, required: false },
    notes: { type: String, required: false, trim: true },
    analytics: { type: SourceAnalyticsSchema, default: () => ({}) },
  },
  { timestamps: true, collection: 'sources' }
)

SourceSchema.index({ status: 1, scrapeFrequency: 1, lastScrapedAt: 1 })

export default models.Source || model('Source', SourceSchema)

```

## ðŸ“„ src/SourceSuggestion.js
*Lines: 31, Size: 982 Bytes*

```javascript
// packages/models/src/SourceSuggestion.js (version 5.0.0)
import mongoose from 'mongoose'
import { SUGGESTION_STATUSES } from './prompt-constants.js'
const { Schema, model, models } = mongoose

const SourceSuggestionSchema = new Schema(
  {
    sourceId: { type: Schema.Types.ObjectId, ref: 'Source', required: true, index: true },
    sourceName: { type: String, required: true, trim: true },
    failedSelector: { type: String, required: true, trim: true },
    suggestedSelectors: {
      headlineSelector: String,
      linkSelector: String,
      headlineTextSelector: String,
      articleSelector: String,
    },
    reasoning: { type: String, required: true, trim: true },
    status: {
      type: String,
      enum: SUGGESTION_STATUSES,
      default: 'pending',
      required: true,
      index: true,
    },
  },
  { timestamps: true, collection: 'source_suggestions' }
)

export default models.SourceSuggestion ||
  model('SourceSuggestion', SourceSuggestionSchema)

```

## ðŸ“„ src/Subscriber.js
*Lines: 71, Size: 2.49 KB*

```javascript
// packages/models/src/Subscriber.js
import mongoose from 'mongoose'
import bcrypt from 'bcryptjs'
import { SUBSCRIBER_ROLES, SUBSCRIPTION_TIERS } from './prompt-constants.js'
const { Schema, model, models } = mongoose

const CountrySubscriptionSchema = new Schema(
  {
    name: { type: String, required: true },
    active: { type: Boolean, default: true, required: true },
  },
  { _id: false }
)

const InteractionSchema = new Schema(
  {
    articles: [{ type: Schema.Types.ObjectId, ref: 'Article' }],
    events: [{ type: Schema.Types.ObjectId, ref: 'SynthesizedEvent' }],
    opportunities: [{ type: Schema.Types.ObjectId, ref: 'Opportunity' }],
  },
  { _id: false }
)

const FilterPreferencesSchema = new Schema(
  {
    globalCountryFilter: { type: [String], default: [] },
  },
  { _id: false }
)

const SubscriberSchema = new Schema(
  {
    email: {
      type: String,
      required: true,
      unique: true,
      trim: true,
      lowercase: true,
      index: true,
    },
    password: { type: String, required: true, select: false },
    firstName: { type: String, required: true, trim: true },
    lastName: { type: String, required: false, trim: true },
    language: { type: String, required: true, default: 'English' },
    countries: { type: [CountrySubscriptionSchema], default: [] },
    role: { type: String, enum: SUBSCRIBER_ROLES, default: 'user', required: true },
    emailNotificationsEnabled: { type: Boolean, default: true },
    pushNotificationsEnabled: { type: Boolean, default: true },
    subscriptionTier: { type: String, enum: SUBSCRIPTION_TIERS, default: 'free' },
    subscriptionExpiresAt: { type: Date, default: null },
    isLifetimeFree: { type: Boolean, default: false },
    isActive: { type: Boolean, default: true, index: true },
    lastLoginAt: { type: Date, default: null },
    discardedItems: { type: InteractionSchema, default: () => ({}) },
    favoritedItems: { type: InteractionSchema, default: () => ({}) },
    filterPreferences: { type: FilterPreferencesSchema, default: () => ({}) },
    emailSentCount: { type: Number, default: 0 },
    eventsReceivedCount: { type: Number, default: 0 },
  },
  { timestamps: true, collection: 'subscribers' }
)

// The pre('save') hook for password hashing has been REMOVED.
// Hashing is now handled explicitly in the data-access layer.

SubscriberSchema.methods.comparePassword = function (candidatePassword) {
  return bcrypt.compare(candidatePassword, this.password)
}

export default models.Subscriber || model('Subscriber', SubscriberSchema)

```

## ðŸ“„ src/SynthesizedEvent.js
*Lines: 74, Size: 2.39 KB*

```javascript
// packages/models/src/SynthesizedEvent.js (version 8.1.0 - Multi-country support)
import mongoose from 'mongoose'
const { Schema, model, models } = mongoose

const SourceArticleSchema = new Schema(
  {
    headline: { type: String, required: true, trim: true },
    link: { type: String, required: true, trim: true },
    newspaper: { type: String, required: true, trim: true },
    imageUrl: { type: String, trim: true },
    country: { type: String, trim: true },
  },
  { _id: false }
)

const KeyIndividualSchema = new Schema(
  {
    name: { type: String, trim: true },
    role_in_event: { type: String, trim: true },
    company: { type: String, trim: true },
    email_suggestion: { type: String, trim: true },
  },
  { _id: false }
)

const SynthesizedEventSchema = new Schema(
  {
    event_key: { type: String, required: true, unique: true, trim: true, index: true },
    synthesized_headline: { type: String, required: true, trim: true },
    synthesized_summary: { type: String, required: true, trim: true },
    advisorSummary: { type: String, trim: true },
    ai_assessment_reason: { type: String, trim: true },
    eventClassification: { type: String, trim: true },
    country: { type: [String], required: true, index: true }, // MODIFIED: Changed to array of strings
    source_articles: { type: [SourceArticleSchema], required: true },
    highest_relevance_score: { type: Number, required: true, min: 0, max: 100 },
    key_individuals: { type: [KeyIndividualSchema], default: [] },
    relatedOpportunities: [
      { type: Schema.Types.ObjectId, ref: 'Opportunity', index: true },
    ],
    enrichmentSources: {
      type: [String],
      enum: ['rag_db', 'wikipedia', 'news_api'],
      default: [],
    },
    emailed: { type: Boolean, default: false },
    email_sent_at: { type: Date },
  },
  {
    timestamps: true,
    collection: 'synthesized_events',
    methods: {
      toRealtimePayload() {
        return {
          _id: this._id,
          synthesized_headline: this.synthesized_headline,
          country: this.country,
          highest_relevance_score: this.highest_relevance_score,
          createdAt: this.createdAt,
        }
      },
    },
  }
)

SynthesizedEventSchema.index({
  synthesized_headline: 'text',
  synthesized_summary: 'text',
})
SynthesizedEventSchema.index({ country: 1, createdAt: -1 })

export default models.SynthesizedEvent ||
  model('SynthesizedEvent', SynthesizedEventSchema)

```

## ðŸ“„ src/WatchlistEntity.js
*Lines: 33, Size: 1.13 KB*

```javascript
// packages/models/src/WatchlistEntity.js (version 2.1.0)
import mongoose from 'mongoose'
import { ENTITY_TYPES, ENTITY_STATUSES } from './prompt-constants.js'

const { Schema, model, models } = mongoose

const WatchlistEntitySchema = new Schema(
  {
    name: { type: String, required: true, unique: true, trim: true, index: true },
    type: { type: String, enum: ENTITY_TYPES, required: true, index: true },
    status: {
      type: String,
      enum: ENTITY_STATUSES,
      default: 'candidate',
      required: true,
      index: true,
    },
    context: { type: String, trim: true, required: false },
    searchTerms: { type: [String], default: [], index: true },
    country: { type: String, trim: true, required: false, index: true },
    hitCount: { type: Number, default: 0, index: true },
    estimatedNetWorthUSD_MM: { type: Number, required: false },
    primaryCompany: { type: String, trim: true, required: false },
    notes: { type: String, trim: true, required: false },
  },
  {
    timestamps: true,
    collection: 'watchlist_entities',
  }
)

export default models.WatchlistEntity || model('WatchlistEntity', WatchlistEntitySchema)

```

## ðŸ“„ src/WatchlistSuggestion.js
*Lines: 33, Size: 1 KB*

```javascript
// packages/models/src/WatchlistSuggestion.js (version 3.0.0 - With Search Terms)
import mongoose from 'mongoose'
import {
  WATCHLIST_SUGGESTION_STATUSES,
  ENTITY_TYPES,
} from './prompt-constants.js'
const { Schema, model, models } = mongoose

const WatchlistSuggestionSchema = new Schema(
  {
    name: { type: String, required: true, unique: true, trim: true, index: true },
    type: { type: String, enum: ENTITY_TYPES, required: true, index: true },
    rationale: { type: String, trim: true, required: true },
    sourceEvent: { type: String, required: true },
    country: { type: String, trim: true, required: false },
    searchTerms: { type: [String], default: [] }, // NEW FIELD
    status: {
      type: String,
      enum: WATCHLIST_SUGGESTION_STATUSES,
      default: 'candidate',
      required: true,
      index: true,
    },
  },
  {
    timestamps: true,
    collection: 'watchlist_suggestions',
  }
)

export default models.WatchlistSuggestion ||
  model('WatchlistSuggestion', WatchlistSuggestionSchema)

```

## ðŸ“„ src/client.js
*Lines: 20, Size: 535 Bytes*

```javascript
// File: packages/models/src/client.js (version 1.0 - New File)
'use client'

// This file is the designated "client-safe" entry point for the models package.
// It ONLY exports constants and contains NO server-side code (like Mongoose).
import * as constants from './prompt-constants.js'

export const {
  ENTITY_TYPES,
  ENTITY_STATUSES,
  SOURCE_STATUSES,
  SOURCE_FREQUENCIES,
  EXTRACTION_METHODS,
  ARTICLE_STATUSES,
  SUGGESTION_STATUSES,
  WATCHLIST_SUGGESTION_STATUSES,
  SUBSCRIBER_ROLES,
  SUBSCRIPTION_TIERS,
} = constants

```

## ðŸ“„ src/index.js
*Lines: 31, Size: 860 Bytes*

```javascript
// This file is the core, shared module for the models package.
// It exports all Mongoose models and is environment-agnostic.

import Article from './Article.js'
import Country from './Country.js'
import Opportunity from './Opportunity.js'
import PushSubscription from './PushSubscription.js'
import RunVerdict from './RunVerdict.js'
import Setting from './Setting.js'
import Source from './Source.js'
import SourceSuggestion from './SourceSuggestion.js'
import Subscriber from './Subscriber.js'
import SynthesizedEvent from './SynthesizedEvent.js'
import WatchlistEntity from './WatchlistEntity.js'
import WatchlistSuggestion from './WatchlistSuggestion.js'

export {
  Article,
  Country,
  Opportunity,
  PushSubscription,
  RunVerdict,
  Setting,
  Source,
  SourceSuggestion,
  Subscriber,
  SynthesizedEvent,
  WatchlistEntity,
  WatchlistSuggestion,
}

```

## ðŸ“„ src/next.js
*Lines: 5, Size: 108 Bytes*

```javascript
import 'server-only'

// Re-export all models for the Next.js server environment
export * from './index.js'

```

## ðŸ“„ src/node.js
*Lines: 3, Size: 84 Bytes*

```javascript
// Re-export all models for the pure Node.js environment
export * from './index.js'

```

## ðŸ“„ src/prompt-constants.js
*Lines: 11, Size: 688 Bytes*

```javascript
export const ENTITY_TYPES = ['person', 'family', 'company'];
export const ENTITY_STATUSES = ['active', 'inactive', 'candidate'];
export const SOURCE_STATUSES = ['active', 'paused', 'under_review'];
export const SOURCE_FREQUENCIES = ['high', 'low'];
export const EXTRACTION_METHODS = ['custom', 'declarative', 'json-ld'];
export const ARTICLE_STATUSES = ['scraped', 'assessed', 'enriched', 'failed_enrichment'];
export const SUGGESTION_STATUSES = ['pending', 'approved', 'rejected'];
export const WATCHLIST_SUGGESTION_STATUSES = ['candidate', 'approved', 'dismissed'];
export const SUBSCRIBER_ROLES = ['user', 'admin'];
export const SUBSCRIPTION_TIERS = ['free', 'premium', 'enterprise'];

```

## ðŸ“„ src/schemas/apiSchemas.js
*Lines: 45, Size: 1.21 KB*

```javascript
// packages/models/src/schemas/apiSchemas.js
import { z } from 'zod'

// Schema for /api/user/interactions
export const interactionSchema = z.object({
  itemId: z.string().min(1),
  itemType: z.enum(['article', 'event', 'opportunity']),
  action: z.enum(['favorite', 'unfavorite', 'discard']),
})

// Schema for /api/upload-article
export const articleUploadSchema = z.object({
  item: z.object({
    headline: z.string().min(1, 'Headline is required'),
    article: z.string().min(1, 'Article content is required'),
  }),
})

// Schema for /api/chat and /api/chat/title
export const chatSchema = z.object({
  messages: z.array(
    z.object({
      role: z.enum(['user', 'assistant']),
      content: z.string(),
      id: z.string().optional(),
      isThinking: z.boolean().optional(),
      isError: z.boolean().optional(),
    })
  ),
})

// Schema for /api-admin/export
export const exportSchema = z.object({
  entity: z.enum(['opportunities', 'users', 'events', 'articles']),
  fileType: z.enum(['csv', 'xlsx']),
  filters: z.array(z.any()).optional(),
  sort: z.string().optional().nullable(),
})

// Schema for /api/auth/login
export const loginSchema = z.object({
  email: z.string().email(),
  password: z.string().min(1),
})

```

## ðŸ“„ src/schemas/articleAssessmentSchema.js
*Lines: 24, Size: 753 Bytes*

```javascript
// packages/ai-services/src/schemas/articleAssessmentSchema.js (version 1.1)
import { z } from 'zod'

export const articleAssessmentSchema = z.object({
  reasoning: z.object({
    event_type: z.string(),
    is_liquidity_event: z.boolean(),
    beneficiary: z.string(),
  }),
  // NEW FIELD: Added classification to the schema.
  classification: z.enum(['New wealth', 'Wealth detection', 'Interview', 'IPO', 'Other']),
  relevance_article: z.number().min(0).max(100),
  assessment_article: z.string().min(1),
  amount: z.number().nullable().optional(),
  key_individuals: z.array(
    z.object({
      name: z.string(),
      role_in_event: z.string(),
      company: z.string().nullable(),
      email_suggestion: z.string().nullable(),
    })
  ),
})

```

## ðŸ“„ src/schemas/articlePreAssessmentSchema.js
*Lines: 7, Size: 223 Bytes*

```javascript
// packages/ai-services/src/schemas/articlePreAssessmentSchema.js (version 1.0)
import { z } from 'zod'

export const articlePreAssessmentSchema = z.object({
  classification: z.enum(['private', 'public', 'corporate']),
})

```

## ðŸ“„ src/schemas/batchArticleAssessmentSchema.js
*Lines: 8, Size: 285 Bytes*

```javascript
// packages/ai-services/src/schemas/batchArticleAssessmentSchema.js (version 1.0)
import { z } from 'zod'
import { articleAssessmentSchema } from './articleAssessmentSchema.js'

export const batchArticleAssessmentSchema = z.object({
  assessments: z.array(articleAssessmentSchema),
})

```

## ðŸ“„ src/schemas/batchHeadlineAssessmentSchema.js
*Lines: 9, Size: 371 Bytes*

```javascript
// packages/ai-services/src/schemas/batchHeadlineAssessmentSchema.js (version 1.0)
import { z } from 'zod'
import { headlineAssessmentSchema } from './headlineAssessmentSchema.js'

// The batch schema reuses the single assessment schema
export const batchHeadlineAssessmentSchema = z.object({
  assessments: z.array(headlineAssessmentSchema.shape.assessment.element),
})

```

## ðŸ“„ src/schemas/canonicalizerSchema.js
*Lines: 7, Size: 188 Bytes*

```javascript
// packages/ai-services/src/schemas/canonicalizerSchema.js (version 1.0)
import { z } from 'zod'

export const canonicalizerSchema = z.object({
  canonical_name: z.string().nullable(),
})

```

## ðŸ“„ src/schemas/clusterSchema.js
*Lines: 12, Size: 250 Bytes*

```javascript
// packages/ai-services/src/schemas/clusterSchema.js (version 1.0)
import { z } from 'zod'

export const clusterSchema = z.object({
  events: z.array(
    z.object({
      event_key: z.string(),
      article_ids: z.array(z.string()),
    })
  ),
})

```

## ðŸ“„ src/schemas/countryCorrectionSchema.js
*Lines: 7, Size: 269 Bytes*

```javascript
// packages/ai-services/src/schemas/countryCorrectionSchema.js
import { z } from 'zod';

export const countryCorrectionSchema = z.object({
  country: z.string().nullable().describe("The single, corrected, UN-recognized country name, or null if not determinable."),
});

```

## ðŸ“„ src/schemas/disambiguationSchema.js
*Lines: 7, Size: 186 Bytes*

```javascript
// packages/ai-services/src/schemas/disambiguationSchema.js (version 1.0)
import { z } from 'zod'

export const disambiguationSchema = z.object({
  best_title: z.string().nullable(),
})

```

## ðŸ“„ src/schemas/emailIntroSchema.js
*Lines: 11, Size: 313 Bytes*

```javascript
// packages/models/src/schemas/emailIntroSchema.js
import { z } from 'zod'

export const emailIntroSchema = z.object({
  greeting: z.string(),
  body: z.string(),
  bullets: z.array(z.string()),
  // The signoff is now an array of strings, with each string representing a line.
  signoff: z.array(z.string()),
})

```

## ðŸ“„ src/schemas/emailSubjectSchema.js
*Lines: 7, Size: 184 Bytes*

```javascript
// packages/ai-services/src/schemas/emailSubjectSchema.js (version 1.0)
import { z } from 'zod'

export const emailSubjectSchema = z.object({
  subject_headline: z.string().min(1),
})

```

## ðŸ“„ src/schemas/enrichContactSchema.js
*Lines: 14, Size: 335 Bytes*

```javascript
// packages/ai-services/src/schemas/enrichContactSchema.js (version 1.0)
import { z } from 'zod'

export const enrichContactSchema = z.object({
  enriched_contacts: z.array(
    z.object({
      name: z.string(),
      role_in_event: z.string(),
      company: z.string(),
      email_suggestion: z.string().nullable(),
    })
  ),
})

```

## ðŸ“„ src/schemas/entitySchema.js
*Lines: 8, Size: 191 Bytes*

```javascript
// packages/ai-services/src/schemas/entitySchema.js (version 1.0)
import { z } from 'zod'

export const entitySchema = z.object({
  reasoning: z.string(),
  entities: z.array(z.string()),
})

```

## ðŸ“„ src/schemas/executiveSummarySchema.js
*Lines: 7, Size: 176 Bytes*

```javascript
// packages/ai-services/src/schemas/executiveSummarySchema.js (version 1.0)
import { z } from 'zod'

export const executiveSummarySchema = z.object({
  summary: z.string(),
})

```

## ðŸ“„ src/schemas/findContactSchema.js
*Lines: 7, Size: 183 Bytes*

```javascript
// packages/ai-services/src/schemas/findContactSchema.js (version 1.0)
import { z } from 'zod'

export const findContactSchema = z.object({
  email: z.string().email().nullable(),
})

```

## ðŸ“„ src/schemas/headlineAssessmentSchema.js
*Lines: 13, Size: 362 Bytes*

```javascript
// packages/ai-services/src/schemas/headlineAssessmentSchema.js (version 1.0)
import { z } from 'zod'

const singleAssessmentSchema = z.object({
  headline_en: z.string(),
  relevance_headline: z.number().min(0).max(100),
  assessment_headline: z.string(),
})

export const headlineAssessmentSchema = z.object({
  assessment: z.array(singleAssessmentSchema),
})

```

## ðŸ“„ src/schemas/index.js
*Lines: 30, Size: 1.17 KB*

```javascript
// packages/models/src/schemas/index.js
// This file is the central, isomorphic entry point for all Zod schemas.

export * from './apiSchemas.js' // Added new API schemas
export * from './articleAssessmentSchema.js'
export * from './articlePreAssessmentSchema.js'
export * from './batchArticleAssessmentSchema.js'
export * from './batchHeadlineAssessmentSchema.js'
export * from './canonicalizerSchema.js'
export * from './clusterSchema.js'
export * from './countryCorrectionSchema.js'
export * from './disambiguationSchema.js'
export * from './emailIntroSchema.js'
export * from './emailSubjectSchema.js'
export * from './enrichContactSchema.js'
export * from './entitySchema.js'
export * from './executiveSummarySchema.js'
export * from './findContactSchema.js'
export * from './headlineAssessmentSchema.js'
export * from './judgeSchema.js'
export * from './opportunitySchema.js'
export * from './ragResponseSchema.js'
export * from './sectionClassifierSchema.js'
export * from './selectorRepairSchema.js'
export * from './synthesisSchema.js'
export * from './translateSchema.js'
export * from './userSchemas.js'
export * from './watchlistSchemas.js'
export * from './watchlistSuggestionSchema.js'

```

## ðŸ“„ src/schemas/judgeSchema.js
*Lines: 14, Size: 404 Bytes*

```javascript
// packages/ai-services/src/schemas/judgeSchema.js (version 1.0)
import { z } from 'zod'

const verdictSchema = z.object({
  identifier: z.string(),
  quality: z.enum(['Excellent', 'Good', 'Acceptable', 'Marginal', 'Poor', 'Irrelevant']),
  commentary: z.string(),
})

export const judgeSchema = z.object({
  event_judgements: z.array(verdictSchema),
  opportunity_judgements: z.array(verdictSchema),
})

```

## ðŸ“„ src/schemas/opportunitySchema.js
*Lines: 22, Size: 929 Bytes*

```javascript
// packages/ai-services/src/schemas/opportunitySchema.js (version 2.1)
import { z } from 'zod'

export const opportunitySchema = z.object({
  opportunities: z.array(
    // DEFINITIVE FIX: Use .passthrough() to allow the AI to include extra fields
    // without causing a validation error. We will only use the fields we define.
    z.object({
      reachOutTo: z.string().describe("The full name of the individual or family to contact."),
      contactDetails: z.object({
        email: z.string().email().nullable(),
        role: z.string().nullable(),
        company: z.string().nullable(),
      }),
      basedIn: z.string().nullable(),
      whyContact: z.array(z.string()).describe("An array of concise, one-sentence reasons for contact."),
      likelyMMDollarWealth: z.number().nullable(),
      event_key: z.string().describe("The unique key of the source event for this opportunity."),
    }).passthrough()
  ),
})

```

## ðŸ“„ src/schemas/ragResponseSchema.js
*Lines: 20, Size: 581 Bytes*

```javascript
// packages/models/src/schemas/ragResponseSchema.js
import { z } from 'zod'

/**
 * Defines the structured response for the RAG synthesizer agent.
 * The answer is broken down into parts, each with its own source attribution.
 */
export const ragResponseSchema = z.object({
  answer_parts: z.array(
    z.object({
      text: z.string().describe('A segment of the final answer.'),
      source: z
        .enum(['rag', 'wiki', 'search', 'llm'])
        .describe(
          'The source of the text segment. "llm" is used for general connective phrasing.'
        ),
    })
  ),
})

```

## ðŸ“„ src/schemas/sectionClassifierSchema.js
*Lines: 14, Size: 411 Bytes*

```javascript
// packages/ai-services/src/schemas/sectionClassifierSchema.js (version 1.0)
import { z } from 'zod'

export const sectionClassifierSchema = z.object({
  classifications: z.array(
    z.object({
      classification: z.enum(['news_section', 'article_headline', 'navigation', 'other']),
      reasoning: z
        .string()
        .describe('A brief explanation for the classification choice.'),
    })
  ),
})

```

## ðŸ“„ src/schemas/selectorRepairSchema.js
*Lines: 13, Size: 415 Bytes*

```javascript
// packages/ai-services/src/schemas/selectorRepairSchema.js (version 1.0)
import { z } from 'zod'

export const selectorRepairSchema = z.object({
  reasoning: z.string(),
  suggested_selectors: z.object({
    headlineSelector: z.string().optional(),
    linkSelector: z.string().optional().nullable(),
    headlineTextSelector: z.string().optional().nullable(),
    articleSelector: z.string().optional(),
  }),
})

```

## ðŸ“„ src/schemas/synthesisSchema.js
*Lines: 27, Size: 860 Bytes*

```javascript
// packages/models/src/schemas/synthesisSchema.js (CORRECTED)
import { z } from 'zod'

export const synthesisSchema = z.object({
  events: z.array(
    z.object({
      headline: z.string().min(1),
      summary: z.string().min(1),
      advisor_summary: z
        .string()
        .min(1)
        .describe('The one-sentence actionable summary for wealth advisors.'),
      eventClassification: z.string().min(1).describe("The event's classification type."),
      // DEFINITIVE FIX: The 'country' field must now be an array of strings.
      country: z.array(z.string()).min(1, 'Country array cannot be empty.'),
      key_individuals: z.array(
        z.object({
          name: z.string(),
          role_in_event: z.string(),
          company: z.string().nullable(),
          email_suggestion: z.string().nullable(),
        })
      ),
    })
  ),
})

```

## ðŸ“„ src/schemas/translateSchema.js
*Lines: 7, Size: 179 Bytes*

```javascript
// packages/ai-services/src/schemas/translateSchema.js (version 1.0.0)
import { z } from 'zod'

export const translateSchema = z.object({
  translated_html: z.string().min(1),
})

```

## ðŸ“„ src/schemas/userSchemas.js
*Lines: 43, Size: 1.5 KB*

```javascript
// packages/models/src/schemas/userSchemas.js
import { z } from 'zod'
import { SUBSCRIBER_ROLES, SUBSCRIPTION_TIERS } from '../prompt-constants.js'

const countrySubscriptionSchema = z.object({
  name: z.string(),
  active: z.boolean(),
})

export const userCreateSchema = z.object({
  email: z.string().email(),
  password: z.string().min(6, 'Password must be at least 6 characters'),
  firstName: z.string().min(1, 'First name is required'),
  lastName: z.string().optional(),
  language: z.string().default('English'),
  countries: z.array(countrySubscriptionSchema).default([]),
  role: z.enum(SUBSCRIBER_ROLES).default('user'),
  emailNotificationsEnabled: z.boolean().default(true),
  pushNotificationsEnabled: z.boolean().default(true),
  subscriptionTier: z.enum(SUBSCRIPTION_TIERS).default('free'),
  isActive: z.boolean().default(true),
})

export const userUpdateSchema = userCreateSchema
  .omit({ email: true }) // Email cannot be changed on update
  .partial() // All fields are optional on update
  .extend({
    // Allow password to be an empty string for "no change"
    password: z
      .string()
      .min(6, 'Password must be at least 6 characters')
      .or(z.literal(''))
      .optional(),
  })

export const signupSchema = z.object({
  name: z.string().min(1, 'Full name is required'),
  email: z.string().email('Invalid email address'),
  password: z.string().min(8, 'Password must be at least 8 characters'),
  countries: z.array(z.string()).default([]),
  plan: z.enum(['trial', 'paid']).default('trial'),
})

```

## ðŸ“„ src/schemas/watchlistSchemas.js
*Lines: 17, Size: 605 Bytes*

```javascript
// packages/models/src/schemas/watchlistSchemas.js
import { z } from 'zod'
import { ENTITY_TYPES, ENTITY_STATUSES } from '../prompt-constants.js'

export const watchlistEntitySchema = z.object({
  name: z.string().min(1, 'Name is required'),
  type: z.enum(ENTITY_TYPES),
  status: z.enum(ENTITY_STATUSES).default('candidate'),
  context: z.string().optional(),
  searchTerms: z.array(z.string()).default([]),
  country: z.string().optional(),
  hitCount: z.number().optional(),
  estimatedNetWorthUSD_MM: z.number().optional(),
  primaryCompany: z.string().optional(),
  notes: z.string().optional(),
})

```

## ðŸ“„ src/schemas/watchlistSuggestionSchema.js
*Lines: 16, Size: 496 Bytes*

```javascript
// packages/ai-services/src/schemas/watchlistSuggestionSchema.js (version 2.0.0 - With Search Terms)
import { z } from 'zod'

export const watchlistSuggestionSchema = z.object({
  suggestions: z.array(
    z.object({
      name: z.string(),
      type: z.enum(['person', 'family', 'company']),
      country: z.string(),
      rationale: z.string(),
      sourceEvent: z.string(),
      searchTerms: z.array(z.string()).describe("An array of 2-4 unique, lowercase search terms."),
    })
  ),
})

```
