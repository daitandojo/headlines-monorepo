// packages/ui/src/ExportButton.jsx (version 1.0)
'use client'

import { useState } from 'react';
import { Button } from './components/button';
import { Download, Loader2 } from 'lucide-react';
import { toast } from 'sonner';

export function ExportButton({ data, filename, exportAction }) {
    const [isLoading, setIsLoading] = useState(false);

    const handleExport = async () => {
        if (!data || data.length === 0) {
            toast.info("No data available to export.");
            return;
        }
        setIsLoading(true);
        const result = await exportAction(data);
        setIsLoading(false);

        if (result.success) {
            const blob = new Blob([result.data], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `${filename}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                toast.success("Export successful!");
            }
        } else {
            toast.error("Export failed", { description: result.error });
        }
    };

    return (
        <Button onClick={handleExport} disabled={isLoading || !data || data.length === 0}>
            {isLoading ? <Loader2 className="mr-2 h-4 w-4 animate-spin" /> : <Download className="mr-2 h-4 w-4" />}
            Export CSV
        </Button>
    );
}
